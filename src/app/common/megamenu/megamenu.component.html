<div class="megamenu-container d-lg-block d-none" [class.open]="isOpen" *ngIf="isOpen" 
     (mouseenter)="onMouseEnter()"
     (mouseleave)="onMouseLeave()"
     (click)="$event.stopPropagation()">
  <div class="megamenu-overlay" (click)="closeMenu.emit()"></div>
  <div class="megamenu-content">
    <div class="container">
      <div class="row g-0">
        @for (item of menuItems; track $index) {
          <div class="col-12">
            <div class="row g-0">
              <!-- Left Column - Features -->
              <div class="col-lg-8 col-12">
                <div class="p-4 megamenu-scrollable">
                  @for (column of item.children; track $index) {
                    @if (column.sections && column.sections.length > 0) {
                      @for (section of column.sections; track $index) {
                        <div class="mb-4">
                          <h6 class="text-uppercase fw-bold mb-3" style="font-size: 11px; letter-spacing: 0.5px; color: #6b7280;">
                            {{ section.title }}
                          </h6>
                          <ul class="list-unstyled mb-4">
                            @for (link of section.items; track $index) {
                              <li class="mb-4 d-flex align-items-start"
                                  (mouseenter)="onMenuItemHover(link.imageUrl)"
                                  (mouseleave)="onMenuItemLeave()">
                                @if (link.icon) {
                                  <div class="flex-shrink-0 me-3 megamenu-icon-wrapper">
                                    <i [class]="link.icon" [style.color]="link.iconColor || '#3b82f6'"></i>
                                  </div>
                                }
                                <div class="flex-grow-1">
                                  @if (link.routerLink) {
                                    <a [routerLink]="link.routerLink" (click)="onLinkClick($event)" 
                                       class="text-decoration-none d-block mb-1 fw-semibold" 
                                       style="color: #111827; font-size: 14px;">
                                      {{ link.title }}
                                      @if (link.showExternalIcon) {
                                        <i class="bi bi-box-arrow-up-right ms-1" style="font-size: 12px;"></i>
                                      }
                                    </a>
                                  } @else if (link.link) {
                                    <a [href]="link.link" (click)="onLinkClick($event)" 
                                       class="text-decoration-none d-block mb-1 fw-semibold" 
                                       style="color: #111827; font-size: 14px;">
                                      {{ link.title }}
                                      @if (link.showExternalIcon) {
                                        <i class="bi bi-box-arrow-up-right ms-1" style="font-size: 12px;"></i>
                                      }
                                    </a>
                                  } @else {
                                    <span class="d-block mb-1 fw-semibold" style="color: #111827; font-size: 14px;">
                                      {{ link.title }}
                                    </span>
                                  }
                                  @if (link.description) {
                                    @if (link.routerLink) {
                                      <a [routerLink]="link.routerLink" 
                                         (click)="onLinkClick($event)" 
                                         class="mb-0 text-decoration-none d-block" 
                                         style="color: #6b7280; font-size: 13px; line-height: 1.5;">
                                        {{ link.description }}
                                      </a>
                                    } @else if (link.link) {
                                      <a [href]="link.link" 
                                         (click)="onLinkClick($event)" 
                                         class="mb-0 text-decoration-none d-block" 
                                         style="color: #6b7280; font-size: 13px; line-height: 1.5;">
                                        {{ link.description }}
                                      </a>
                                    } @else {
                                      <p class="mb-0" style="color: #6b7280; font-size: 13px; line-height: 1.5;">
                                        {{ link.description }}
                                      </p>
                                    }
                                  }
                                </div>
                              </li>
                            }
                          </ul>
                        </div>
                      }
                    }
                    
                  }
                </div>
              </div>

              <!-- Right Column - Image and Guide (Hidden on Mobile) -->
              <div class="col-lg-4 d-lg-block d-none">
                @if (item.rightPanel) {
                  <div class="h-100 position-relative d-flex flex-column" style="min-height: 100%;">
                    <!-- Image -->
                    @if (item.rightPanel.imageUrl) {
                      <div class="flex-grow-1 position-relative" style="min-height: 400px;">
                        <!-- Default Image -->
                        <div class="position-absolute top-0 start-0 w-100 h-100 megamenu-image-base"
                             [class.megamenu-image-fade]="!!hoveredImageUrl"
                             [style.background-image]="'url(' + item.rightPanel.imageUrl + ')'"
                             style="background-size: cover; background-position: center;">
                        </div>
                        <!-- Hover Image -->
                        @if (hoveredImageUrl) {
                          <div class="position-absolute top-0 start-0 w-100 h-100 megamenu-image-hover"
                               [style.background-image]="'url(' + hoveredImageUrl + ')'"
                               style="background-size: cover; background-position: center;">
                          </div>
                        }
                      </div>
                    }
                    
                    <!-- Guide Section at Bottom -->
                    @for (column of item.children; track $index) {
                      @if (column.guide) {
                        <div class="p-4 border-top">
                          <p class="mb-2 fw-semibold" style="color: #111827; font-size: 14px;">
                            {{ column.guide.question }}
                          </p>
                          @if (column.guide.routerLink) {
                            <a [routerLink]="column.guide.routerLink" (click)="onLinkClick($event)"
                               class="text-decoration-none d-inline-flex align-items-center fw-semibold px-3 py-2 guide-link"
                               style="color: #3b82f6; font-size: 14px; border: 1px solid #3b82f6; border-radius: 6px; transition: all 0.3s ease;">
                              {{ column.guide.linkText }}
                              <i class="bi bi-arrow-right ms-2" style="font-size: 12px;"></i>
                            </a>
                          } @else if (column.guide.link) {
                            <a [href]="column.guide.link" (click)="onLinkClick($event)"
                               class="text-decoration-none d-inline-flex align-items-center fw-semibold px-3 py-2 guide-link"
                               style="color: #3b82f6; font-size: 14px; border: 1px solid #3b82f6; border-radius: 6px; transition: all 0.3s ease;">
                              {{ column.guide.linkText }}
                              <i class="bi bi-arrow-right ms-2" style="font-size: 12px;"></i>
                            </a>
                          }
                        </div>
                      }
                    }
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>

